<?xml version="1.0" encoding="UTF-8" ?>

<templates xml:space="preserve">

    <t t-name="muk_web_appsbar.AppsBar">
        <div class="mk_apps_sidebar_panel">
            <div class="mk_apps_sidebar">
                <ul class="mk_apps_sidebar_menu">
                    <!-- Show main apps when in 'apps' view -->
                    <t t-if="state.currentView === 'apps'">
                        <t t-foreach="this.appMenuService.getAppsMenuItems()" t-as="app" t-key="app.id">
                            <li t-attf-class="nav-item {{ app.id === this.appMenuService.getCurrentApp()?.id ? 'active' : '' }}">
                                <a 
                                    t-att-href="app.href"
                                    t-att-data-menu-id="app.id" 
                                    t-att-data-menu-xmlid="app.xmlid" 
                                    t-att-data-action-id="app.actionID"
                                    t-on-click.prevent="() => this._onAppClick(app)"
                                    class="nav-link" 
                                    role="menuitem"
                                >
                                    <img 
                                        t-if="app.webIconData" 
                                        class="mk_apps_sidebar_icon" 
                                        t-att-src="app.webIconData"
                                    />
                                    <img  
                                        t-else="" 
                                        class="mk_apps_sidebar_icon" 
                                        src="/base/static/description/icon.png"
                                    />
                                    <span class="mk_apps_sidebar_name">
                                        <t t-out="app.label"/>
                                    </span>
                                </a>
                            </li>
                        </t>
                    </t>

                    <!-- Show children menus when in 'children' view -->
                    <t t-if="state.currentView === 'children'">
                        <!-- Back to Apps Button -->
                        <li class="nav-item mk_apps_back_item">
                            <a 
                                href="#"
                                class="nav-link mk_apps_back_link"
                                t-on-click.prevent="() => this._onBackToApps()"
                            >
                                <i class="fa fa-arrow-left"/>
                                <span class="mk_apps_sidebar_name">Back to Apps</span>
                            </a>
                        </li>

                        <!-- Selected App Header -->
                        <li class="nav-item mk_apps_current_app">
                            <div class="nav-link">
                                <img 
								    t-if="state.selectedApp and state.selectedApp.webIconData"
								    class="mk_apps_sidebar_icon" 
								    t-att-src="state.selectedApp.webIconData"
								/>
                                <img  
                                    t-else="" 
                                    class="mk_apps_sidebar_icon" 
                                    src="/base/static/description/icon.png"
                                />
                                <span class="mk_apps_sidebar_name">
								    <t t-if="state.selectedApp" t-out="state.selectedApp.label || state.selectedApp.name"/>
								</span>
                            </div>
                        </li>

                        <!-- Children Menus (Draggable) -->
                        <t t-foreach="state.childrenMenus" t-as="child" t-key="child.id">
                            <li 
                                t-attf-class="nav-item mk_apps_child_item {{ this._isMenuActive(child) ? 'active' : '' }} {{ state.expandedMenus[child.id] ? 'mk_apps_expanded' : '' }} {{ state.draggedItemId === child.id ? 'mk_apps_dragging' : '' }}"
                                draggable="true"
                                t-att-data-menu-id="child.id"
                                t-on-dragstart="(e) => this._onDragStart(e, child)"
                                t-on-dragend="(e) => this._onDragEnd(e)"
                                t-on-dragover="(e) => this._onDragOver(e, child)"
                                t-on-drop="(e) => this._onDrop(e, child)"
                                t-on-dragleave="(e) => this._onDragLeave(e)"
                            >
                                <a 
                                    t-att-href="child.href"
                                    t-att-data-menu-id="child.id"
                                    t-on-click.prevent="(e) => this._onChildClick(child, e)"
                                    class="nav-link" 
                                    role="menuitem"
                                >
                                    <i class="fa fa-grip-vertical mk_apps_drag_handle" title="Drag to reorder"/>
                                    <span class="mk_apps_sidebar_name">
                                        <t t-out="child.name"/>
                                    </span>
                                    <!-- Optional indicator for items with children -->
                                    <i t-if="this._hasChildren(child)" class="fa fa-angle-down mk_apps_has_children_indicator"/>
                                </a>

                                <!-- Grandchildren Dropdown -->
                                <ul 
                                    t-if="this._hasChildren(child) and state.expandedMenus[child.id]" 
                                    class="mk_apps_grandchildren_menu"
                                >
                                    <t t-foreach="this._getGrandchildrenMenus(child)" t-as="grandchild" t-key="grandchild.id">
                                        <li t-attf-class="nav-item mk_apps_grandchild_item {{ this._isMenuActive(grandchild) ? 'active' : '' }} {{ state.expandedMenus[grandchild.id] ? 'mk_apps_expanded' : '' }}">
                                            <a 
                                                t-att-href="grandchild.href"
                                                t-att-data-menu-id="grandchild.id"
                                                t-on-click.prevent="(e) => this._onGrandchildClick(grandchild, e)"
                                                class="nav-link" 
                                                role="menuitem"
                                            >
                                                <span class="mk_apps_sidebar_name">
                                                    <t t-out="grandchild.name"/>
                                                </span>
                                                <!-- Optional indicator for items with children -->
                                                <i t-if="this._hasChildren(grandchild)" class="fa fa-angle-down mk_apps_has_children_indicator"/>
                                            </a>

                                            <!-- Great-Grandchildren Dropdown -->
                                            <ul 
                                                t-if="this._hasChildren(grandchild) and state.expandedMenus[grandchild.id]" 
                                                class="mk_apps_great_grandchildren_menu"
                                            >
                                                <t t-foreach="this._getGreatGrandchildrenMenus(grandchild)" t-as="greatgrandchild" t-key="greatgrandchild.id">
                                                    <li t-attf-class="nav-item {{ this._isMenuActive(greatgrandchild) ? 'active' : '' }}">
                                                        <a 
                                                            t-att-href="greatgrandchild.href"
                                                            t-att-data-menu-id="greatgrandchild.id"
                                                            t-on-click.prevent="() => this._onGreatGrandchildClick(greatgrandchild)"
                                                            class="nav-link" 
                                                            role="menuitem"
                                                        >
                                                            <span class="mk_apps_sidebar_name">
                                                                <t t-out="greatgrandchild.name"/>
                                                            </span>
                                                        </a>
                                                    </li>
                                                </t>
                                            </ul>
                                        </li>
                                    </t>
                                </ul>
                            </li>
                        </t>
                    </t>
                </ul>

                <div t-if="sidebarImageUrl" class="mk_apps_sidebar_logo p-2">
                    <img class="img-fluid mx-auto" t-att-src="sidebarImageUrl" alt="Logo"/>
                </div>
            </div>
        </div>
    </t>
    
</templates>